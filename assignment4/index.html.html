<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Assignment 4 - Caricature</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.3/p5.js"></script>
    <style> body { margin: 0; padding: 0; overflow: hidden; } canvas { display: block; } </style>
</head>
<body>
    <script>
        // ⭐ 과제 4: 캐리커처 (좌표 수정 완료)
        let centerX = 175;
        let centerY = 160;

        const PALETTE = {
            skin: '#F7D4B6', hair: '#5C3A21', lips: '#E54F6D', white: '#FFFFFF', black: '#000000',
            blush: 'rgba(229, 79, 109, 0.2)', hat: '#C75D5D', hatBand: '#D4AC87',
            sky: '#87CEEB', cloud: '#FFFFFF', sea: '#66DDAA', field: '#FFDD00', ground: '#90EE90',
        };

        function setup() {
            createCanvas(350, 350);
            angleMode(DEGREES);
        }

        function draw() {
            // 캐릭터가 화면 밖으로 나가지 않도록 제한
            centerX = constrain(centerX, 50, 300);
            centerY = constrain(centerY, 100, 250);

            if (keyIsDown(LEFT_ARROW)) centerX -= 3;
            if (keyIsDown(RIGHT_ARROW)) centerX += 3;
            if (keyIsDown(UP_ARROW)) centerY -= 3;
            if (keyIsDown(DOWN_ARROW)) centerY += 3;

            drawBackground();
            drawHair_Back();
            drawShoulder();
            drawHat_Back();
            drawFace();
            drawHat_Top();
            drawEyes();
            drawNose();
            drawMouth();
            drawHat_Front();
        }

        function drawBackground() {
            noStroke();
            fill(PALETTE.sky);
            rect(0, 0, width, height / 2 + 50);
            fill(PALETTE.cloud);
            ellipse(100, 80, 100, 60);
            ellipse(150, 70, 120, 70);
            ellipse(300, 100, 150, 80); 
            ellipse(280, 90, 110, 60);  
            fill(PALETTE.sea);
            rect(0, height / 2 + 50, width, height / 4);
            fill(PALETTE.field);
            rect(0, height * 3 / 4 + 50, width, height / 4 - 50);
            fill(PALETTE.ground);
            rect(0, height * 3 / 4, width, 50);
        }

        function drawFace() {
            noStroke();
            fill(PALETTE.skin);
            rect(centerX - 25, centerY - 20, 50, 80);
            ellipse(centerX, centerY, 180, 220);
            let blushOpacity = mouseIsPressed ? 0.7 : 0.2;
            fill('rgba(229, 79, 109, ' + blushOpacity + ')');
            ellipse(centerX - 50, centerY + 40, 50, 30);
            ellipse(centerX + 50, centerY + 40, 50, 30);
        }

        function drawEyes() {
            const eyeY = centerY + 10;
            let pOffsetX = map(mouseX, 0, width, -5, 5);
            let pOffsetY = map(mouseY, 0, height, -3, 3);
            pOffsetX = constrain(pOffsetX, -5, 5);
            pOffsetY = constrain(pOffsetY, -3, 3);

            // 왼쪽 눈
            const eyeLX = centerX - 40;
            fill(PALETTE.white); stroke(PALETTE.black); strokeWeight(2);
            arc(eyeLX, eyeY, 50, 35, 180, 360, CHORD);
            fill(PALETTE.black); noStroke();
            ellipse(eyeLX + pOffsetX, eyeY + 4 + pOffsetY, 18, 18);
            fill(PALETTE.white); ellipse(eyeLX - 3, eyeY + 1, 5, 5);
            noFill(); stroke(PALETTE.hair); strokeWeight(4);
            arc(eyeLX, eyeY - 25, 40, 20, 180, 360);

            // 오른쪽 눈
            const eyeRX = centerX + 40;
            fill(PALETTE.white); stroke(PALETTE.black); strokeWeight(2);
            arc(eyeRX, eyeY, 50, 35, 180, 360, CHORD);
            fill(PALETTE.black); noStroke();
            ellipse(eyeRX + pOffsetX, eyeY + 4 + pOffsetY, 18, 18);
            fill(PALETTE.white); ellipse(eyeRX + 3, eyeY + 1, 5, 5);
            noFill(); stroke(PALETTE.hair); strokeWeight(4);
            arc(eyeRX, eyeY - 25, 40, 20, 180, 360);
        }

        function drawNose() {
            stroke(PALETTE.black); strokeWeight(1.5);
            const noseY = centerY + 30;
            line(centerX, noseY, centerX - 5, noseY + 20);
            line(centerX - 5, noseY + 20, centerX + 5, noseY + 20);
        }

        function drawMouth() {
            const mouthY = centerY + 70;
            fill(PALETTE.lips); noStroke();
            arc(centerX - 15, mouthY, 30, 20, 180, 360);
            arc(centerX + 15, mouthY, 30, 20, 180, 360);
            if (keyIsDown(84)) { // 'T' key
                fill(PALETTE.black);
                arc(centerX, mouthY + 5, 50, 40, 0, 180, CHORD);
            } else {
                stroke(PALETTE.black); strokeWeight(2);
                arc(centerX, mouthY + 2, 60, 40, 0, 180, CHORD);
                fill(PALETTE.white); noStroke();
                arc(centerX, mouthY + 2, 56, 25, 0, 180);
            }
        }

        function drawHair_Back() {
            fill(PALETTE.hair); noStroke();
            let hairStartY = centerY - 100;
            rect(centerX - 120, hairStartY, 110, 350, 0, 0, 20, 20);
            rect(centerX + 10, hairStartY, 110, 350, 0, 0, 20, 20);
        }

        function drawHat_Top() {
            const hatY = centerY - 120;
            noStroke(); fill(PALETTE.hat); ellipse(centerX, hatY, 170, 140);
            fill(PALETTE.hatBand); rect(centerX - 95, hatY, 190, 25, 10);
        }

        function drawHat_Back() {
            const hatY = centerY - 110;
            noStroke(); fill(PALETTE.hat); arc(centerX, hatY, 350, 180, 150, 390);
        }

        function drawHat_Front() {
            const hatY = centerY - 100;
            noStroke(); fill(PALETTE.hat); arc(centerX, hatY, 350, 150, 0, 180);
        }

        function drawShoulder() {
            const shoulderY = centerY + 180;
            const shoulderSize = 210;
            const shoulderOffset = 130;
            fill(PALETTE.white); stroke('#DDDDDD'); strokeWeight(3);
            arc(centerX - shoulderOffset, shoulderY, shoulderSize, shoulderSize, 180, 360);
            arc(centerX + shoulderOffset, shoulderY, shoulderSize, shoulderSize, 180, 360);
            noStroke(); rect(centerX - shoulderOffset, shoulderY - 90, shoulderOffset * 2, 110);
        }

        function keyPressed() {
            if (key === 's' || key === 'S') saveGif('myCaricature.gif', 5);
        }
    </script>
</body>
</html>