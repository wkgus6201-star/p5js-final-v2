let colorEvening;
let colorNight;
let stars = []; // Array for stars

function setup() {
    createCanvas(350, 350); // Ï∫îÎ≤ÑÏä§ ÌÅ¨Í∏∞ Ïú†ÏßÄ
    frameRate(24); // Set frame rate for GIF size

    colorEvening = color(180, 190, 230);
    colorNight = color(10, 20, 50);

    // Create 150 stars in random positions
    for (let i = 0; i < 150; i++) {
        stars.push({
            x: random(width),
            y: random(height * 0.7) // Only in the upper 70% of sky
        });
    }
}

function draw() {
    // --- MODIFICATION 1: Looping Day/Night Cycle ---
    let transitionFrames = 120;
    let angle = frameCount * (PI / transitionFrames);
    let cosValue = cos(angle);
    let progress = map(cosValue, 1, -1, 0, 1);

    // Sky color transition
    let skyColor = lerpColor(colorEvening, colorNight, progress);
    background(skyColor);

    // Draw stars
    let starAlpha = map(progress, 0.3, 1, 0, 255);
    stroke(255, 255, 200, starAlpha);

    for (let s of stars) {
        // --- MODIFICATION 2: Faster Twinkle ---
        let starSize = map(sin(frameCount * 0.4 + s.x), -1, 1, 1, 3);
        strokeWeight(starSize);
        point(s.x, s.y);
    }

    // Sun and Moon movement
    noStroke();

    // Sun: When progress 0->1 (sets)
    fill(255, 240, 180);
    let sunY = map(progress, 0, 1, 180, 350);
    // üö® XÏ¢åÌëú ÏàòÏ†ï: 150 (ÏõêÎûò Ï∫îÎ≤ÑÏä§ Í∏∞Ï§Ä) -> 175 (350 Ï∫îÎ≤ÑÏä§Ïùò Ï§ëÏã¨)Î°ú ÏàòÏ†ï
    ellipse(175, sunY, 120, 120);

    // Moon: When progress 0->1 (rises)
    let moonAlpha = map(progress, 0.2, 0.7, 0, 255);
    fill(255, 255, 220, moonAlpha);
    let moonY = map(progress, 0, 1, 350, 150);

    // Draw crescent moon
    // üö® XÏ¢åÌëú ÏàòÏ†ï: 450 (ÏõêÎûò Ï∫îÎ≤ÑÏä§ Í∏∞Ï§Ä) -> 300 (350 Ï∫îÎ≤ÑÏä§ Ïò§Î•∏Ï™Ω)ÏúºÎ°ú ÏàòÏ†ï
    ellipse(300, moonY, 80, 80);
    fill(skyColor); // Use sky color to cover part of it
    noStroke();
    // üö® XÏ¢åÌëú ÏàòÏ†ï: 430 -> 280ÏúºÎ°ú ÏàòÏ†ï
    ellipse(280, moonY - 5, 80, 80); // Draw shadow

    // Draw original hills
    noStroke();
    // üö® Ïñ∏Îçï Ï¢åÌëú ÏàòÏ†ï (ÏõêÎûò 600x400 Í∏∞Ï§ÄÏùÑ 350x350Ïóê ÎßûÏ∂∞ ÏàòÏ†ï)
    // Í∞ÄÏû• Îí§Ï™Ω Ïñ∏Îçï
    fill(150, 160, 200);
    // (ÏõêÎûò 600, 350) -> (350, 306)ÏúºÎ°ú ÏàòÏ†ï
    triangle(0, 245, 175, 131, 350, 306);
    
    // Ï§ëÍ∞Ñ Ïñ∏Îçï
    fill(120, 130, 180);
    // (ÏõêÎûò 700, 400) -> (408, 350)ÏúºÎ°ú ÏàòÏ†ï (350ÏùÑ Î≤óÏñ¥ÎÇòÎäî Ï¢åÌëúÎäî 350ÏúºÎ°ú Ï†úÌïú)
    triangle(0, 350, 117, 175, 408, 350); 
    
    // Í∞ÄÏû• ÏïûÏ™Ω Ïñ∏Îçï
    fill(90, 100, 150);
    // (ÏõêÎûò 600, 400) -> (350, 350)ÏúºÎ°ú ÏàòÏ†ï
    triangle(-29, 350, 262, 219, 350, 350);

    // Draw original trees
    let sway = sin(frameCount * 0.1) * 2;

    // Left tree
    // üö® X, Y Ï¢åÌëú ÏàòÏ†ï (180, 180 -> 105, 157)
    fill(80, 60, 40);
    rect(105, 157, 10, 40);
    fill(80, 130, 100);
    stroke(255);
    strokeWeight(3);
    // üö® X Ï¢åÌëú ÏàòÏ†ï (185 -> 110)
    ellipse(110 + sway, 175, 40, 40); // Apply sway

    // Right tree
    noStroke();
    // üö® X, Y Ï¢åÌëú ÏàòÏ†ï (430, 250 -> 250, 219)
    fill(80, 60, 40);
    rect(250, 219, 15, 60);
    fill(70, 110, 90);
    // üö® X Ï¢åÌëú ÏàòÏ†ï (438 -> 258)
    ellipse(258 + sway, 240, 70, 70); // Apply sway
}

// Save functions
function keyPressed() {
    if (key === 's' || key === 'S') {
        saveCanvas('night_landscape_static', 'png');
    }

    if (key === 'g' || key === 'G') {
        // Save a 10-second GIF
        saveGif('myAnimatedNightScene', 10);
    }
}